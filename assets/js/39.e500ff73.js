(window.webpackJsonp=window.webpackJsonp||[]).push([[39,51],{56:function(e,t,n){},59:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var a={DEFAULT:"mapbox://styles/huanglii/ck1n985b20oan1cmhp4i0o9c9?optimize=true",SATELLITE:"mapbox://styles/mapbox/satellite-v9",DARK:"mapbox://styles/huanglii/ck1ocwsbl1fja1cloy67tyefi?optimize=true",GRAY:"mapbox://styles/huanglii/ck1naxpm00gvj1co6r4pxgxzl?optimize=true",MONOCHROME:"mapbox://styles/huanglii/ck3gplwrs0baz1cpe6mgy8aap?optimize=true",FLUORESCENCE:"mapbox://styles/huanglii/ck23131s00los1cnz1qjms49i?optimize=true",WATERLIGHT:"mapbox://styles/huanglii/cjweb960x1nbn1drxxtuaz9cr?optimize=true"}},61:function(e,t,n){"use strict";var a=n(56);n.n(a).a},62:function(e,t,n){"use strict";n.r(t);n(67),n(68),n(66),n(31);var a=n(76),o=n.n(a),i=n(71),r=n.n(i),s=(n(77),n(73)),c=n(74),l=function(){function e(t){Object(s.a)(this,e),this._className="mapboxgl-ctrl",this._options=Object.assign({},{zoom:1,center:[0,0]},t),this._onClickHome=this._onClickHome.bind(this)}return Object(c.a)(e,[{key:"onAdd",value:function(e){return this._map=e,this._container=p.create("div","".concat(this._className," mapboxgl-ctrl-group")),this._render(),this._container}},{key:"onRemove",value:function(){p.remove(this._container),this._map=void 0}},{key:"_render",value:function(){var e=p.create("button","".concat(this._className,"-icon ").concat(this._className,"-home"),this._container);e.type="button",e.addEventListener("click",this._onClickHome)}},{key:"_onClickHome",value:function(){this._map.easeTo(this._options)}}]),e}(),p={create:function(e,t,n){var a=window.document.createElement(e);return void 0!==t&&(a.className=t),n&&n.appendChild(a),a},remove:function(e){e.parentNode&&e.parentNode.removeChild(e)}},u=n(59),d=(n(78),{name:"base-map",props:{height:{type:Number,default:520},mapOptions:{type:Object},mapClickable:{type:Boolean,default:!0},borderOptions:{type:Object}},data:function(){return{map:null,maploaded:!1,mapDefaultOptions:{container:o()(),style:u.a.DEFAULT,center:[-74.5,40],zoom:6,minZoom:0,maxZoom:22,scrollZoom:!0,pitch:0,bearing:0,antialias:!1},borderDefaultOptions:{layout:{visibility:"none"},paint:{"line-color":"hsl(357, 67%, 60%)","line-opacity":["step",["zoom"],1,10,0],"line-width":["interpolate",["linear"],["zoom"],0,1,22,3]},beforeId:""}}},computed:{mapContainer:function(){return this.mapOptions.container||this.mapDefaultOptions.container}},mounted:function(){var e=Object.assign({},this.mapDefaultOptions,this.mapOptions);this.initMap(e),window.addEventListener("resize",this.resize)},methods:{initMap:function(e){r.a.accessToken="pk.eyJ1IjoiaHVhbmdsaWkiLCJhIjoiY2pzNHBtendwMDZ2ZDQzbnVmZXdtMDlvdiJ9.GSija86yNNR4ssBtFFpx0g",this.map=new r.a.Map(e),this.map.addControl(new r.a.NavigationControl,"top-left");var t=e.center,n=e.zoom,a=e.pitch,o=e.bearing;this.map.addControl(new l({center:t,zoom:n,pitch:a,bearing:o}),"bottom-left"),this.map.addControl(new r.a.FullscreenControl,"top-left"),this.map.on("load",this.handleMapLoaded)},handleMapLoaded:function(e){this.maploaded=!0,this.$emit("load",e.target),this.mapClickable&&this.map.on("click",this.handleMapClick)},handleMapClick:function(e){console.log(e.lngLat);var t=this.map.queryRenderedFeatures(e.point);if(t.length>0){var n=t[0],a=n.layer,o=n.properties;Object.keys(o).length>0&&(new r.a.Popup).setLngLat(e.lngLat).setHTML(this.createPropHtml(a.id,o)).addTo(this.map)}},createPropHtml:function(e,t){return'\n        <div class="title"><b>'.concat(e,'</b></div>\n        <div class="content">\n          ').concat(Object.keys(t).map((function(e){return"".concat("<p><b>".concat(e,": </b>").concat(t[e],"</p>"))})).join(""),"\n        </div>\n      ")},addBorderLayer:function(){var e=Object.assign({},this.borderDefaultOptions,this.borderOptions),t=e.layout,n=e.paint,a=e.beforeId;this.map.addSource("border",{type:"vector",url:"mapbox://huanglii.4nxu8jv0"}),this.map.addLayer({id:"border-2oej0r",source:"border","source-layer":"Border-2oej0r",type:"line",layout:t,paint:n},a||void 0)},resize:function(){this.map.resize()}}}),m=(n(61),n(0)),h=Object(m.a)(d,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"map-wrapper"},[t("div",{style:{width:"100%",height:this.height+"px",borderRadius:"6px"},attrs:{id:this.mapContainer}},[this._t("custom")],2),this._v(" "),this.maploaded?this._t("default"):this._e()],2)}),[],!1,null,null,null);t.default=h.exports},652:function(e,t,n){"use strict";n.r(t);var a=n(62),o=n(59),i=(n(286),n(214),n(205),n(492)),r=n(71),s=n.n(r),c=n(506),l=n.n(c),p=n(215),u=n.n(p),d=(n(576),n(587),"point-source");var m={components:{baseMap:a.default},data:function(){return{mapOptions:{style:o.a.GRAY,center:[107.744809,30.180706],zoom:6,minZoom:4}}},methods:{handleMapLoaded:function(e){!function(e,t){var n=new s.a.Popup({closeButton:!1,closeOnClick:!1,offset:[0,-40]});e.addSource(d,{type:"geojson",data:t,cluster:!0,clusterRadius:85}),e.addLayer({id:"earthquake_circle",type:"circle",source:d,paint:{"circle-radius":0}}),e.on("data",(function(t){t.sourceId===d&&t.isSourceLoaded&&(e.on("move",r),e.on("moveend",r),r())}));var a={},o={};function r(){return c.apply(this,arguments)}function c(){return(c=Object(i.a)(regeneratorRuntime.mark((function t(){var n,i,r,c,l,u,h,f,b,v,y;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n={},i=e.querySourceFeatures(d),r=e.getSource(d),c=0;case 4:if(!(c<i.length)){t.next=25;break}if(l=i[c],u=l.geometry.coordinates,h=void 0,!(f=l.properties).cluster){t.next=16;break}return h=f.cluster_id,t.next=13,m(h,r,l);case 13:f=t.sent,t.next=18;break;case 16:h=f.id,f=l.properties;case 18:(b=a[h])||(f.coords=u,v=p(f),b=a[h]=new s.a.Marker({element:v}).setLngLat(u)),n[h]=b,o[h]||b.addTo(e);case 22:c++,t.next=4;break;case 25:for(y in o)n[y]||o[y].remove();o=n;case 27:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function p(t){var a=document.createElement("div");a.style.width="".concat(80,"px"),a.style.height="".concat(80,"px");var o=u.a.init(a),i=t.name,r=t.coords;return o.setOption({title:{show:!0,text:i.length>4?"".concat(i.substring(0,3),"··"):i,left:"center",top:"center",textStyle:{fontSize:12,textShadowBlur:5,textShadowColor:"#3EAF7C"},padding:0,shadowColor:"rgba(0, 0, 0, 0.5)",shadowBlur:10},color:["#FFD273","#E86D68","#A880FF"],series:[{type:"pie",name:"".concat(i,"|").concat(r),radius:["40%","96%"],center:["50%","50%"],hoverAnimation:!1,label:{show:!0,position:"inside",formatter:"{c}"},labelLine:{show:!1},data:[{value:t.v1,name:"土豆"},{value:t.v2,name:"玉米"},{value:t.v3,name:"红薯"}]}]}),o.on("mouseover",(function(t){var a=t.seriesName,o=t.data,i=a.split("|"),r=i[0],s=i[1].split(","),c='<p style="padding: 0 10px;">'.concat(r,": ").concat(o.name," ").concat(o.value," 万顷</p>");n.setLngLat(s).setHTML(c).addTo(e)})),o.on("mouseout",(function(e){n.remove()})),a}function m(e,t,n){return new Promise((function(a,o){t.getClusterLeaves(e,30,0,(function(e,t){e&&o(e);for(var i=1/0,r=0,s=0;s<t.length;s++){var c=l()(n,t[s]);c<i&&(r=s,i=c)}var p=t[r].properties;a(p)}))}))}}(e,this.$withBase("/data/point.geojson"))}}},h=n(0),f=Object(h.a)(m,(function(){var e=this.$createElement;return(this._self._c||e)("base-map",{attrs:{"map-options":this.mapOptions},on:{load:this.handleMapLoaded}})}),[],!1,null,null,null);t.default=f.exports}}]);