(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{317:function(e,t,n){"use strict";var i="#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\n\nstruct AmbientLight {\n vec3 color;\n};\n\nstruct PointLight {\n vec3 color;\n vec3 position;\n vec3 attenuation;\n};\n\nstruct DirectionalLight {\n  vec3 color;\n  vec3 direction;\n};\n\nuniform AmbientLight lighting_uAmbientLight;\nuniform PointLight lighting_uPointLight[MAX_LIGHTS];\nuniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];\nuniform int lighting_uPointLightCount;\nuniform int lighting_uDirectionalLightCount;\n\nuniform bool lighting_uEnabled;\n\nfloat getPointLightAttenuation(PointLight pointLight, float distance) {\n  return pointLight.attenuation.x\n       + pointLight.attenuation.y * distance\n       + pointLight.attenuation.z * distance * distance;\n}\n\n#endif\n",r={name:"lights",vs:i,fs:i,getUniforms:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a;if("lightSources"in t){var n=t.lightSources||{},i=n.ambientLight,r=n.pointLights,o=n.directionalLights,l=i||r&&r.length>0||o&&o.length>0;return l?Object.assign({},s({ambientLight:i,pointLights:r,directionalLights:o}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){var u={pointLights:[],directionalLights:[]},c=!0,g=!1,h=void 0;try{for(var d,p=(t.lights||[])[Symbol.iterator]();!(c=(d=p.next()).done);c=!0){var v=d.value;switch(v.type){case"ambient":u.ambientLight=v;break;case"directional":u.directionalLights.push(v);break;case"point":u.pointLights.push(v)}}}catch(e){g=!0,h=e}finally{try{c||null==p.return||p.return()}finally{if(g)throw h}}return e({lightSources:u})}return{}},defines:{MAX_LIGHTS:3}},a={};function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.color,n=void 0===t?[0,0,0]:t,i=e.intensity,r=void 0===i?1:i;return n.map((function(e){return e*r/255}))}function s(e){var t=e.ambientLight,n=e.pointLights,i=void 0===n?[]:n,r=e.directionalLights,a=void 0===r?[]:r,s={};return s["lighting_uAmbientLight.color"]=t?o(t):[0,0,0],i.forEach((function(e,t){s["lighting_uPointLight[".concat(t,"].color")]=o(e),s["lighting_uPointLight[".concat(t,"].position")]=e.position,s["lighting_uPointLight[".concat(t,"].attenuation")]=e.attenuation||[1,0,0]})),s.lighting_uPointLightCount=i.length,a.forEach((function(e,t){s["lighting_uDirectionalLight[".concat(t,"].color")]=o(e),s["lighting_uDirectionalLight[".concat(t,"].direction")]=e.direction})),s.lighting_uDirectionalLightCount=a.length,s}var l="\nuniform float lighting_uAmbient;\nuniform float lighting_uDiffuse;\nuniform float lighting_uShininess;\nuniform vec3  lighting_uSpecularColor;\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {\n    vec3 halfway_direction = normalize(light_direction + view_direction);\n    float lambertian = dot(light_direction, normal_worldspace);\n    float specular = 0.0;\n    if (lambertian > 0.0) {\n      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n      specular = pow(specular_angle, lighting_uShininess);\n    }\n    lambertian = max(lambertian, 0.0);\n    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;\n}\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = surfaceColor;\n\n  if (lighting_uEnabled) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uPointLightCount) {\n        break;\n      }\n      PointLight pointLight = lighting_uPointLight[i];\n      vec3 light_position_worldspace = pointLight.position;\n      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n    }\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uDirectionalLightCount) {\n        break;\n      }\n      DirectionalLight directionalLight = lighting_uDirectionalLight[i];\n      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n    }\n  }\n  return lightColor;\n}\n\nvec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = vec3(0, 0, 0);\n  vec3 surfaceColor = vec3(0, 0, 0);\n\n  if (lighting_uEnabled) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uPointLightCount) {\n        break;\n      }\n      PointLight pointLight = lighting_uPointLight[i];\n      vec3 light_position_worldspace = pointLight.position;\n      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n    }\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uDirectionalLightCount) {\n        break;\n      }\n      DirectionalLight directionalLight = lighting_uDirectionalLight[i];\n      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n    }\n  }\n  return lightColor;\n}\n";n.d(t,"a",(function(){return u}));var u={name:"gouraud-lighting",dependencies:[r],vs:l,defines:{LIGHTING_VERTEX:1},getUniforms:h},c={};function g(e){var t=e.ambient,n=void 0===t?.35:t,i=e.diffuse,r=void 0===i?.6:i,a=e.shininess,o=void 0===a?32:a,s=e.specularColor;return{lighting_uAmbient:n,lighting_uDiffuse:r,lighting_uShininess:o,lighting_uSpecularColor:(void 0===s?[30,30,30]:s).map((function(e){return e/255}))}}function h(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c;if(!("material"in e))return{};var t=e.material;return t?g(t):{lighting_uEnabled:!1}}},481:function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var i=n(57),r=n(58),a=n(64),o=n(63),s=n(86),l=n(65),u=n(314),c=n(173),g=n(212),h=function(e){function t(){return Object(i.a)(this,t),Object(a.a)(this,Object(o.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(r.a)(t,[{key:"getSubLayers",value:function(){return this.internalState&&this.internalState.subLayers||[]}},{key:"initializeState",value:function(){}},{key:"setState",value:function(e){Object(s.a)(Object(o.a)(t.prototype),"setState",this).call(this,e),this.setNeedsUpdate()}},{key:"getPickingInfo",value:function(e){var t=e.info,n=t.object;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id?Object.assign(t,{object:n.__source.object,index:n.__source.index}):t}},{key:"renderLayers",value:function(){return null}},{key:"shouldRenderSubLayer",value:function(e,t){var n=this.props._subLayerProps;return t&&t.length||n&&n[e]}},{key:"getSubLayerClass",value:function(e,t){var n=this.props._subLayerProps;return n&&n[e]&&n[e].type||t}},{key:"getSubLayerRow",value:function(e,t,n){return e.__source={parent:this,object:t,index:n},e}},{key:"getSubLayerAccessor",value:function(e){if("function"==typeof e){var t={data:this.props.data,target:[]};return function(n,i){return n.__source?(t.index=n.__source.index,e(n.__source.object,t)):e(n,i)}}return e}},{key:"getSubLayerProps",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.props,n=t.opacity,i=t.pickable,r=t.visible,a=t.parameters,o=t.getPolygonOffset,s=t.highlightedObjectIndex,l=t.autoHighlight,u=t.highlightColor,c=t.coordinateSystem,g=t.coordinateOrigin,h=t.wrapLongitude,d=t.positionFormat,p=t.modelMatrix,v=t.extensions,f=t._subLayerProps,m={opacity:n,pickable:i,visible:r,parameters:a,getPolygonOffset:o,highlightedObjectIndex:s,autoHighlight:l,highlightColor:u,coordinateSystem:c,coordinateOrigin:g,wrapLongitude:h,positionFormat:d,modelMatrix:p,extensions:v},y=f&&f[e.id],b=y&&y.updateTriggers,_=e.id||"sublayer";if(y){var S=this.constructor._propTypes;for(var L in y){var x=S[L];x&&"accessor"===x.type&&(y[L]=this.getSubLayerAccessor(y[L]))}}Object.assign(m,e,y,{id:"".concat(this.props.id,"-").concat(_),updateTriggers:Object.assign({all:this.props.updateTriggers.all},e.updateTriggers,b)});var w=!0,P=!1,k=void 0;try{for(var O,D=v[Symbol.iterator]();!(w=(O=D.next()).done);w=!0){var C=O.value,j=C.getSubLayerProps.call(this,C);j&&Object.assign(m,j,{updateTriggers:Object.assign(m.updateTriggers,j.updateTriggers)})}}catch(e){P=!0,k=e}finally{try{w||null==D.return||D.return()}finally{if(P)throw k}}return m}},{key:"_getAttributeManager",value:function(){return null}},{key:"_renderLayers",value:function(){var e=this.internalState.subLayers,t=!e||this.needsUpdate();t&&(e=this.renderLayers(),e=Object(g.b)(e,{filter:Boolean}),this.internalState.subLayers=e),Object(c.a)("compositeLayer.renderLayers",this,t,e);var n=!0,i=!1,r=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){a.value.parent=this}}catch(e){i=!0,r=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}}},{key:"isComposite",get:function(){return!0}}]),t}(u.a);h.layerName="CompositeLayer"},613:function(e,t,n){"use strict";var i=n(57),r=n(58),a=n(84),o=n(641),s=n(483);function l(e){var t=e.map,n=e.gl,i=e.deck;if(t.__deck)return t.__deck;var r=i&&i.props._customRender,s={useDevicePixels:!0,_customRender:function(){t.triggerRepaint(),r&&r()},parameters:{depthMask:!0,depthTest:!0,blendFunc:[770,771,1,771],blendEquation:32774},userData:{isExternal:!1,mapboxLayers:new Set}};return i?(i.setProps(s),i.props.userData.isExternal=!0):(Object.assign(s,{gl:n,width:!1,height:!1,viewState:u(t)}),i=new o.a(s),t.on("move",(function(){return function(e,t){e.setProps({viewState:u(t)}),e.needsRedraw({clearRedrawFlags:!0})}(i,t)})),t.on("remove",(function(){i.finalize(),t.__deck=null}))),i.props.userData.mapboxVersion=function(e){var t=0,n=0;if(e.version){var i=e.version.split(".").slice(0,2).map(Number),r=Object(a.a)(i,2);t=r[0],n=r[1]}return{major:t,minor:n}}(t),t.__deck=i,t.on("render",(function(){return function(e,t){var n=e.props.userData,i=n.mapboxLayers;if(n.isExternal){var r=Array.from(i,(function(e){return e.id})),a=g(e,(function(e){var t=!0,n=!1,i=void 0;try{for(var a,o=r[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){if(h(a.value,e))return!1}}catch(e){n=!0,i=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}return!0}));a.length>0&&e._drawLayers("mapbox-repaint",{viewports:[c(e,t,!1)],layers:a,clearCanvas:!1})}e.props.userData.currentViewport=null}(i,t)})),i}function u(e){var t=e.getCenter();return{longitude:t.lng,latitude:t.lat,zoom:e.getZoom(),bearing:e.getBearing(),pitch:e.getPitch()}}function c(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=e.props.userData.mapboxVersion;return new s.a(Object.assign({x:0,y:0,width:e.width,height:e.height},u(t),n?{nearZMultiplier:1===i.major&&i.minor>=3||i.major>=2?.02:1/(e.height||1)}:{nearZMultiplier:.1}))}function g(e,t){return e.layerManager.getLayers().filter(t)}function h(e,t){for(var n=t;n;){if(n.id===e)return!0;n=n.parent}return!1}function d(e){if(!e.props.userData.isExternal){var t=[];e.props.userData.mapboxLayers.forEach((function(e){var n=new(0,e.props.type)(e.props);t.push(n)})),e.setProps({layers:t})}}n.d(t,"a",(function(){return p}));var p=function(){function e(t){if(Object(i.a)(this,e),!t.id)throw new Error("Layer must have an unique id");this.id=t.id,this.type="custom",this.renderingMode=t.renderingMode||"3d",this.map=null,this.deck=null,this.props=t}return Object(r.a)(e,[{key:"onAdd",value:function(e,t){var n,i;this.map=e,this.deck=l({map:e,gl:t,deck:this.props.deck}),n=this.deck,i=this,n.props.userData.mapboxLayers.add(i),d(n)}},{key:"onRemove",value:function(){var e,t;e=this.deck,t=this,e.props.userData.mapboxLayers.delete(t),d(e)}},{key:"setProps",value:function(e){Object.assign(this.props,e,{id:this.id}),this.deck&&d(this.deck)}},{key:"render",value:function(e,t){var n,i,r,a;n=this.deck,i=this.map,r=this,(a=n.props.userData.currentViewport)||(a=c(n,i,!0),n.props.userData.currentViewport=a),n._drawLayers("mapbox-repaint",{viewports:[a],layers:g(n,(function(e){return h(r.id,e)})),clearCanvas:!1})}}]),e}()},643:function(e,t,n){"use strict";var i=n(72),r=n(57),a=n(58),o=n(64),s=n(63),l=n(86),u=n(65),c=n(97),g=n(330),h=n(317),d=n(333),p=n(314),v=n(396),f=n(474);function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(n,!0).forEach((function(t){Object(i.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var b=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(r.a)(this,t);var n=e.id,i=void 0===n?Object(f.c)("column-geometry"):n,a=_(e),l=a.indices,u=a.attributes;return Object(o.a)(this,Object(s.a)(t).call(this,y({},e,{id:i,indices:l,attributes:u})))}return Object(u.a)(t,e),t}(n(477).a);function _(e){var t=e.radius,n=e.height,i=void 0===n?1:n,r=e.nradial,a=void 0===r?10:r,o=e.vertices;c.a.assert(!o||o.length>=a);for(var s=a+1,l=3*s,u=2*Math.PI/a,g=new Uint16Array(3*a*2),h=new Float32Array(3*l),d=new Float32Array(3*l),p=0,v=0;v<s;v++)for(var f=v*u,m=o&&o[v%a],y=o&&o[(v+1)%a],b=Math.sin(f),_=Math.cos(f),S=0;S<2;S++)h[p+0]=m?m[0]:_*t,h[p+1]=m?m[1]:b*t,h[p+2]=(.5-S)*i,d[p+0]=m?y[0]-m[0]:_,d[p+1]=m?y[1]-m[1]:b,p+=3;for(var L=0;L<s;L++){var x=Math.floor(L/2)*Math.sign(L%2-.5),w=x*u,P=o&&o[(x+a)%a],k=Math.sin(w),O=Math.cos(w);h[p+0]=P?P[0]:O*t,h[p+1]=P?P[1]:k*t,h[p+2]=i/2,d[p+2]=1,p+=3}for(var D=0,C=0;C<a;C++)g[D++]=2*C+0,g[D++]=2*C+2,g[D++]=2*C+0,g[D++]=2*C+1,g[D++]=2*C+1,g[D++]=2*C+3;return{indices:g,attributes:{POSITION:{size:3,value:h},NORMAL:{size:3,value:d}}}}var S=[0,0,0,255],L={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:"accessor",value:function(e){return e.position}},getFillColor:{type:"accessor",value:S},getLineColor:{type:"accessor",value:S},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}},x=function(e){function t(){return Object(r.a)(this,t),Object(o.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(a.a)(t,[{key:"getShaders",value:function(){return Object(l.a)(Object(s.a)(t.prototype),"getShaders",this).call(this,{vs:"\n#define SHADER_NAME column-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 normals;\n\nattribute vec3 instancePositions;\nattribute float instanceElevations;\nattribute vec3 instancePositions64Low;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute float instanceStrokeWidths;\n\nattribute vec3 instancePickingColors;\nuniform float opacity;\nuniform float radius;\nuniform float angle;\nuniform vec2 offset;\nuniform bool extruded;\nuniform bool isStroke;\nuniform float coverage;\nuniform float elevationScale;\nuniform float edgeDistance;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nvarying vec4 vColor;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n\n  vec4 color = isStroke ? instanceLineColors : instanceFillColors;\n  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));\n  float elevation = 0.0;\n  float strokeOffsetRatio = 1.0;\n\n  if (extruded) {\n    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;\n  } else if (isStroke) {\n    float widthPixels = clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n      widthMinPixels, widthMaxPixels) / 2.0;\n    strokeOffsetRatio += sign(positions.z) * project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);\n  }\n  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);\n  float dotRadius = radius * coverage * shouldRender;\n\n  geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));\n  geometry.pickingColor = instancePickingColors;\n  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);\n  vec3 centroidPosition64Low = instancePositions64Low;\n  vec3 pos = vec3(project_size(rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius, 0.);\n  DECKGL_FILTER_SIZE(pos, geometry);\n\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  if (extruded && !isStroke) {\n    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);\n    vColor = vec4(lightColor, color.a * opacity);\n  } else {\n    vColor = vec4(color.rgb, color.a * opacity);\n  }\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME column-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[g.a,h.a,d.a]})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getFillColor",defaultValue:S},instanceLineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getLineColor",defaultValue:S},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}},{key:"updateState",value:function(e){var n=e.props,i=e.oldProps,r=e.changeFlags;Object(l.a)(Object(s.a)(t.prototype),"updateState",this).call(this,{props:n,oldProps:i,changeFlags:r});var a=r.extensionsChanged;if(a){var o=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(o)}),this.getAttributeManager().invalidateAll()}(a||n.diskResolution!==i.diskResolution||n.vertices!==i.vertices)&&this._updateGeometry(n)}},{key:"getGeometry",value:function(e,t){var n=new b({radius:1,height:2,vertices:t,nradial:e}),i=0;if(t)for(var r=0;r<e;r++){var a=t[r];i+=Math.sqrt(a[0]*a[0]+a[1]*a[1])/e}else i=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*i}),n}},{key:"_getModel",value:function(e){return new v.a(e,Object.assign({},this.getShaders(),{id:this.props.id,isInstanced:!0}))}},{key:"_updateGeometry",value:function(e){var t=e.diskResolution,n=e.vertices,i=this.getGeometry(t,n);this.setState({fillVertexCount:i.attributes.POSITION.value.length/3,wireframeVertexCount:i.indices.value.length}),this.state.model.setProps({geometry:i})}},{key:"draw",value:function(e){var t=e.uniforms,n=this.context.viewport,i=this.props,r=i.lineWidthUnits,a=i.lineWidthScale,o=i.lineWidthMinPixels,s=i.lineWidthMaxPixels,l=i.elevationScale,u=i.extruded,c=i.filled,g=i.stroked,h=i.wireframe,d=i.offset,p=i.coverage,v=i.radius,f=i.angle,m=this.state,y=m.model,b=m.fillVertexCount,_=m.wireframeVertexCount,S=m.edgeDistance,L="pixels"===r?n.metersPerPixel:1;y.setUniforms(Object.assign({},t,{radius:v,angle:f/180*Math.PI,offset:d,extruded:u,coverage:p,elevationScale:l,edgeDistance:S,widthScale:a*L,widthMinPixels:o,widthMaxPixels:s})),u&&h&&(y.setProps({isIndexed:!0}),y.setVertexCount(_).setDrawMode(1).setUniforms({isStroke:!0}).draw()),c&&(y.setProps({isIndexed:!1}),y.setVertexCount(b).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!u&&g&&(y.setProps({isIndexed:!1}),y.setVertexCount(2*b/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}}]),t}(p.a);x.layerName="ColumnLayer",x.defaultProps=L;var w=Math.PI/3,P=[0,w,2*w,3*w,4*w,5*w];function k(e){return e[0]}function O(e){return e[1]}var D=n(208);var C=n(88),j=n(84);function M(e,t,n){var i=n;return i.domain=function(){return e},i.range=function(){return t},i}function A(e,t){return M(e,t,(function(n){return function(e,t,n){var i=e[1]-e[0];if(i<=0)return c.a.warn("quantizeScale: invalid domain, returning range[0]")(),t[0];var r=i/t.length,a=Math.floor((n-e[0])/r),o=Math.max(Math.min(a,t.length-1),0);return t[o]}(e,t,n)}))}function E(e,t){return M(e,t,(function(n){return function(e,t,n){return(n-e[0])/(e[1]-e[0])*(t[1]-t[0])+t[0]}(e,t,n)}))}function T(e,t){for(var n=e.sort(F),i=0,r=Math.max(1,t.length),a=new Array(r-1);++i<r;)a[i-1]=I(n,i/r);var o=function(e){return function(e,t,n){return t[function(e,t){var n=0,i=e.length;for(;n<i;){var r=n+i>>>1;F(e[r],t)>0?i=r:n=r+1}return n}(e,n)]}(a,t,e)};return o.thresholds=function(){return a},M(e,t,o)}function F(e,t){return e-t}function I(e,t){var n=e.length;if(t<=0||n<2)return e[0];if(t>=1)return e[n-1];var i=(n-1)*t,r=Math.floor(i),a=e[r];return a+(e[r+1]-a)*(i-r)}function V(e,t){var n=new Map,i=[],r=!0,a=!1,o=void 0;try{for(var s,l=e[Symbol.iterator]();!(r=(s=l.next()).done);r=!0){var u=s.value,c="".concat(u);n.has(c)||n.set(c,i.push(u))}}catch(e){a=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(a)throw o}}return M(e,t,(function(e){return function(e,t,n,i){var r="".concat(i),a=t.get(r);return void 0===a&&(a=e.push(i),t.set(r,a)),n[(a-1)%n.length]}(i,n,t,e)}))}function U(e){return null!=e}function R(e,t){return("function"==typeof t?e.map(t):e).filter(U)}function z(e,t){return R(e,t)}function B(e,t){return n=R(e,t),i=[],n.forEach((function(e){!i.includes(e)&&U(e)&&i.push(e)})),i;var n,i}var N=function(e){return e.length},G=function(e){return e.points},W=function(e){return e.index},H={getValue:N,getPoints:G,getIndex:W,filterData:null},X=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:H;Object(r.a)(this,e),this.aggregatedBins=this.getAggregatedBins(t,n),this._updateMinMaxValues(),this.binMap=this.getBinMap()}return Object(a.a)(e,[{key:"getAggregatedBins",value:function(e,t){for(var n=t.getValue,i=void 0===n?N:n,r=t.getPoints,a=void 0===r?G:r,o=t.getIndex,s=void 0===o?W:o,l=t.filterData,u="function"==typeof l,c=e.length,g=[],h=0,d=0;d<c;d++){var p=e[d],v=a(p),f=s(p),m=u?v.filter(l):v;p.filteredPoints=u?m:null;var y=m.length?i(m):null;null!=y&&(g[h]={i:Number.isFinite(f)?f:d,value:y,counts:m.length},h++)}return g}},{key:"_percentileToIndex",value:function(e){var t=this.sortedBins.length;if(t<2)return[0,0];var n=e.map((function(e){return t=e,n=0,i=100,Math.max(n,Math.min(i,t));var t,n,i})),i=Object(j.a)(n,2),r=i[0],a=i[1];return[Math.ceil(r/100*(t-1)),Math.floor(a/100*(t-1))]}},{key:"getBinMap",value:function(){var e={},t=!0,n=!1,i=void 0;try{for(var r,a=this.aggregatedBins[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var o=r.value;e[o.i]=o}}catch(e){n=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw i}}return e}},{key:"_updateMinMaxValues",value:function(){var e=0,t=0,n=3402823466e29,i=0,r=!0,a=!1,o=void 0;try{for(var s,l=this.aggregatedBins[Symbol.iterator]();!(r=(s=l.next()).done);r=!0){var u=s.value;e=e>u.counts?e:u.counts,t=t>u.value?t:u.value,n=n<u.value?n:u.value,i+=u.counts}}catch(e){a=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(a)throw o}}this.maxCount=e,this.maxValue=t,this.minValue=n,this.totalCount=i}},{key:"getValueRange",value:function(e){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort((function(e,t){return e.value-t.value}))),!this.sortedBins.length)return[];var t=0,n=this.sortedBins.length-1;if(Array.isArray(e)){var i=this._percentileToIndex(e);t=i[0],n=i[1]}return[this.sortedBins[t].value,this.sortedBins[n].value]}},{key:"getValueDomainByScale",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=Object(j.a)(t,2),i=n[0],r=void 0===i?0:i,a=n[1],o=void 0===a?100:a;if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort((function(e,t){return e.value-t.value}))),!this.sortedBins.length)return[];var s=this._percentileToIndex([r,o]);return this._getScaleDomain(e,s)}},{key:"_getScaleDomain",value:function(e,t){var n=Object(j.a)(t,2),i=n[0],r=n[1],a=this.sortedBins;switch(e){case"quantize":case"linear":return[a[i].value,a[r].value];case"quantile":return z(a.slice(i,r+1),(function(e){return e.value}));case"ordinal":return B(a,(function(e){return e.value}));default:return[a[i].value,a[r].value]}}}]),e}(),q={SUM:1,MEAN:2,MIN:3,MAX:4};function K(e,t){return e+t}function Z(e,t){return t>e?t:e}function J(e,t){return t<e?t:e}function Y(e,t){switch(q[e.toUpperCase()]||q.SUM){case q.MIN:return function(e){return function(e,t){var n=e.map(t).filter(Number.isFinite);return n.length?n.reduce(J,1/0):null}(e,t)};case q.SUM:return function(e){return function(e,t){var n=e.map(t).filter(Number.isFinite);return n.length?n.reduce(K,0):null}(e,t)};case q.MEAN:return function(e){return function(e,t){var n=e.map(t).filter(Number.isFinite);return n.length?n.reduce(K,0)/n.length:null}(e,t)};case q.MAX:return function(e){return function(e,t){var n=e.map(t).filter(Number.isFinite);return n.length?n.reduce(Z,-1/0):null}(e,t)};default:return null}}function Q(){}var $=["getBins","getDomain","getScaleFunc"],ee=[{key:"fillColor",accessor:"getFillColor",pickingInfo:"colorValue",getBins:{triggers:{value:{prop:"getColorValue",updateTrigger:"getColorValue"},weight:{prop:"getColorWeight",updateTrigger:"getColorWeight"},aggregation:{prop:"colorAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"lowerPercentile"},upperPercentile:{prop:"upperPercentile"},scaleType:{prop:"colorScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"colorDomain"},range:{prop:"colorRange"}},onSet:{props:"onSetColorDomain"}},nullValue:[0,0,0,0]},{key:"elevation",accessor:"getElevation",pickingInfo:"elevationValue",getBins:{triggers:{value:{prop:"getElevationValue",updateTrigger:"getElevationValue"},weight:{prop:"getElevationWeight",updateTrigger:"getElevationWeight"},aggregation:{prop:"elevationAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"elevationLowerPercentile"},upperPercentile:{prop:"elevationUpperPercentile"},scaleType:{prop:"elevationScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"elevationDomain"},range:{prop:"elevationRange"}},onSet:{props:"onSetElevationDomain"}},nullValue:-1}],te=function(e){return e.cellSize},ne=function(){function e(t){Object(r.a)(this,e),this.state={layerData:{},dimensions:{}},this.changeFlags={},this.dimensionUpdaters={},this._getCellSize=t.getCellSize||te,this._getAggregator=t.getAggregator,this._addDimension(t.dimensions||ee)}return Object(a.a)(e,[{key:"updateState",value:function(e,t){var n=e.oldProps,i=e.props,r=e.changeFlags;this.updateGetValueFuncs(n,i,r);var a=this.needsReProjectPoints(n,i,r),o=!1;r.dataChanged||a?(this.getAggregatedData(i,t),o=!0):((this.getDimensionChanges(n,i,r)||[]).forEach((function(e){return"function"==typeof e&&e()})),o=!0);return this.setState({aggregationDirty:o}),this.state}},{key:"setState",value:function(e){this.state=Object.assign({},this.state,e)}},{key:"setDimensionState",value:function(e,t){this.setState({dimensions:Object.assign({},this.state.dimensions,Object(i.a)({},e,Object.assign({},this.state.dimensions[e],t)))})}},{key:"normalizeResult",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.hexagons?Object.assign({data:e.hexagons},e):e.layerData?Object.assign({data:e.layerData},e):e}},{key:"getAggregatedData",value:function(e,t){var n=this._getAggregator(e)(e,t);this.setState({layerData:this.normalizeResult(n)}),this.changeFlags={layerData:!0},this.getSortedBins(e)}},{key:"updateGetValueFuncs",value:function(e,t,n){for(var i in this.dimensionUpdaters){var r=this.dimensionUpdaters[i].getBins.triggers,a=r.value,o=r.weight,s=r.aggregation,l=t[a.prop];this.needUpdateDimensionStep(this.dimensionUpdaters[i].getBins,e,t,n)&&null===l&&(l=Y(t[s.prop],t[o.prop])),l&&this.setDimensionState(i,{getValue:l})}}},{key:"needsReProjectPoints",value:function(e,t,n){return this._getCellSize(e)!==this._getCellSize(t)||this._getAggregator(e)!==this._getAggregator(t)||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPosition)}},{key:"addDimension",value:function(e){this._addDimension(e)}},{key:"_addDimension",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.forEach((function(t){var n=t.key;e.dimensionUpdaters[n]=e.getDimensionUpdaters(t),e.state.dimensions[n]={getValue:null,domain:null,sortedBins:null,scaleFunc:Q}}))}},{key:"getDimensionUpdaters",value:function(e){var t=e.key,n=e.accessor,i=e.pickingInfo,r=e.getBins,a=e.getDomain,o=e.getScaleFunc,s=e.nullValue;return{key:t,accessor:n,pickingInfo:i,getBins:Object.assign({updater:this.getDimensionSortedBins},r),getDomain:Object.assign({updater:this.getDimensionValueDomain},a),getScaleFunc:Object.assign({updater:this.getDimensionScale},o),attributeAccessor:this.getSubLayerDimensionAttribute(t,s)}}},{key:"needUpdateDimensionStep",value:function(e,t,n,i){return Object.values(e.triggers).some((function(e){return e.updateTrigger?i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged[e.updateTrigger]):t[e.prop]!==n[e.prop]}))}},{key:"getDimensionChanges",value:function(e,t,n){var i=this,r=[],a=function(a){var o=$.find((function(r){return i.needUpdateDimensionStep(i.dimensionUpdaters[a][r],e,t,n)}));o&&r.push(i.dimensionUpdaters[a][o].updater.bind(i,t,i.dimensionUpdaters[a]))};for(var o in this.dimensionUpdaters)a(o);return r.length?r:null}},{key:"getUpdateTriggers",value:function(e){var t=this,n=e.updateTriggers||{},i={},r=function(r){var a=t.dimensionUpdaters[r].accessor;i[a]={},$.forEach((function(o){Object.values(t.dimensionUpdaters[r][o].triggers).forEach((function(t){var r=t.prop,o=t.updateTrigger;if(o){var s=n[o];"object"!==Object(C.a)(s)||Array.isArray(s)?void 0!==s&&(i[a][r]=s):Object.assign(i[a],s)}else i[a][r]=e[r]}))}))};for(var a in this.dimensionUpdaters)r(a);return i}},{key:"getSortedBins",value:function(e){for(var t in this.dimensionUpdaters)this.getDimensionSortedBins(e,this.dimensionUpdaters[t])}},{key:"getDimensionSortedBins",value:function(e,t){var n=t.key,i=this.state.dimensions[n].getValue,r=new X(this.state.layerData.data||[],{getValue:i,filterData:e._filterData});this.setDimensionState(n,{sortedBins:r}),this.getDimensionValueDomain(e,t)}},{key:"getDimensionValueDomain",value:function(e,t){var n=t.getDomain,i=t.key,r=n.triggers,a=r.lowerPercentile,o=r.upperPercentile,s=r.scaleType,l=this.state.dimensions[i].sortedBins.getValueDomainByScale(e[s.prop],[e[a.prop],e[o.prop]]);this.setDimensionState(i,{valueDomain:l}),this.getDimensionScale(e,t)}},{key:"getDimensionScale",value:function(e,t){var n=t.key,i=t.getScaleFunc,r=t.getDomain,a=i.triggers,o=a.domain,s=a.range,l=r.triggers.scaleType,u=i.onSet,c=e[s.prop],g=e[o.prop]||this.state.dimensions[n].valueDomain,h=function(e){switch(e){case"quantize":return A;case"linear":return E;case"quantile":return T;case"ordinal":return V;default:return A}}(l&&e[l.prop])(g,c);"object"===Object(C.a)(u)&&"function"==typeof e[u.props]&&e[u.props](h.domain()),this.setDimensionState(n,{scaleFunc:h})}},{key:"getSubLayerDimensionAttribute",value:function(e,t){var n=this;return function(i){var r=n.state.dimensions[e],a=r.sortedBins,o=r.scaleFunc,s=a.binMap[i.index];if(s&&0===s.counts)return t;var l=s&&s.value,u=o.domain();return l>=u[0]&&l<=u[u.length-1]?o(l):t}}},{key:"getSubLayerAccessors",value:function(e){var t={};for(var n in this.dimensionUpdaters){t[this.dimensionUpdaters[n].accessor]=this.getSubLayerDimensionAttribute(e,n)}return t}},{key:"getPickingInfo",value:function(e){var t=e.info,n=null;if(t.picked&&t.index>-1){var i=this.state.layerData.data[t.index],r={};for(var a in this.dimensionUpdaters){var o=this.dimensionUpdaters[a].pickingInfo,s=this.state.dimensions[a].sortedBins,l=s.binMap[i.index]&&s.binMap[i.index].value;r[o]=l}n=Object.assign(r,i,{points:i.filteredPoints||i.points})}return Object.assign(t,{picked:Boolean(n),object:n})}},{key:"getAccessor",value:function(e){return this.dimensionUpdaters.hasOwnProperty(e)?this.dimensionUpdaters[e].attributeAccessor:Q}}],[{key:"defaultDimensions",value:function(){return ee}}]),e}(),ie=n(480),re=n(606),ae=n(481),oe=n(75);function se(e,t){var n={};for(var i in e)t.includes(i)||(n[i]=e[i]);return n}var le=function(e){function t(){return Object(r.a)(this,t),Object(o.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(a.a)(t,[{key:"initializeState",value:function(e){Object(l.a)(Object(s.a)(t.prototype),"initializeState",this).call(this),this.setState({ignoreProps:se(this.constructor._propTypes,e.data.props),dimensions:e})}},{key:"updateState",value:function(e){if(Object(l.a)(Object(s.a)(t.prototype),"updateState",this).call(this,e),e.changeFlags.extensionsChanged){var n=this.getShaders({});n&&n.defines&&(n.defines.NON_INSTANCED_MODEL=1),this.updateShaders(n)}this._updateAttributes(e.props)}},{key:"updateAttributes",value:function(e){this.setState({changedAttributes:e})}},{key:"getAttributes",value:function(){return this.getAttributeManager().getShaderAttributes()}},{key:"getModuleSettings",value:function(){var e=this.context,t=e.viewport,n=e.mousePosition,i=e.gl;return Object.assign(Object.create(this.props),{viewport:t,mousePosition:n,pickingActive:0,devicePixelRatio:Object(oe.c)(i)})}},{key:"updateShaders",value:function(e){}},{key:"isAggregationDirty",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.props,i=e.oldProps,r=e.changeFlags,a=t.compareAll,o=void 0!==a&&a,s=t.dimension,l=this.state.ignoreProps,u=s.props,c=s.accessors,g=void 0===c?[]:c,h=r.updateTriggersChanged;if(h){if(h.all)return!0;var d=!0,p=!1,v=void 0;try{for(var f,m=g[Symbol.iterator]();!(d=(f=m.next()).done);d=!0){var y=f.value;if(h[y])return!0}}catch(e){p=!0,v=e}finally{try{d||null==m.return||m.return()}finally{if(p)throw v}}}if(o)return!!r.extensionsChanged||Object(ie.a)({oldProps:i,newProps:n,ignoreProps:l,propTypes:this.constructor._propTypes});var b=!0,_=!1,S=void 0;try{for(var L,x=u[Symbol.iterator]();!(b=(L=x.next()).done);b=!0){var w=L.value;if(n[w]!==i[w])return!0}}catch(e){_=!0,S=e}finally{try{b||null==x.return||x.return()}finally{if(_)throw S}}return!1}},{key:"isAttributeChanged",value:function(e){var t=this.state.changedAttributes;return e?t&&void 0!==t[e]:!function(e){var t=!0;for(var n in e){t=!1;break}return t}(t)}},{key:"_getAttributeManager",value:function(){return new re.a(this.context.gl,{id:this.props.id,stats:this.context.stats})}}]),t}(ae.a);function ue(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function ce(){}le.layerName="AggregationLayer",n.d(t,"a",(function(){return he}));var ge={colorDomain:null,colorRange:[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]],getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:function(e){return 1}},colorAggregation:"SUM",lowerPercentile:{type:"number",value:0,min:0,max:100},upperPercentile:{type:"number",value:100,min:0,max:100},colorScaleType:"quantize",onSetColorDomain:ce,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:function(e){return 1}},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",value:0,min:0,max:100},elevationUpperPercentile:{type:"number",value:100,min:0,max:100},elevationScale:{type:"number",min:0,value:1},elevationScaleType:"linear",onSetElevationDomain:ce,radius:{type:"number",value:1e3,min:1},coverage:{type:"number",min:0,max:1,value:1},extruded:!1,hexagonAggregator:function(e,t){var n=e.data,i=e.radius,r=t.viewport,a=t.attributes,o=n.length?function(e,t){var n,i=t.attributes,r=i.positions.value,a=i.positions.getAccessor().size,o=1/0,s=1/0,l=-1/0,u=-1/0;for(n=0;n<a*e.length;n+=a){var c=r[n],g=r[n+1];Number.isFinite(c)&&Number.isFinite(g)&&(o=Math.min(c,o),l=Math.max(c,l),s=Math.min(g,s),u=Math.max(g,u))}return[o,s,l,u].every(Number.isFinite)?[(o+l)/2,(s+u)/2]:null}(n,t):null,s=function(e,t,n){var i=t.getDistanceScales(n).unitsPerMeter;return e*i[0]}(i,r,o),l=[],u=Object(D.a)(n),g=u.iterable,h=u.objectInfo,d=a.positions.value,p=a.positions.getAccessor().size,v=!0,f=!1,m=void 0;try{for(var y,b=g[Symbol.iterator]();!(v=(y=b.next()).done);v=!0){var _=y.value;h.index++;var S=h.index*p,L=[d[S],d[S+1]];Number.isFinite(L[0])&&Number.isFinite(L[1])?l.push(Object.assign({screenCoord:r.projectFlat(L)},_)):c.a.warn("HexagonLayer: invalid position")()}}catch(e){f=!0,m=e}finally{try{v||null==b.return||b.return()}finally{if(f)throw m}}return{hexagons:function(){var e,t,n,i=0,r=0,a=1,o=1,s=k,l=O;function u(e){var i,r={},a=[],o=e.length;for(i=0;i<o;++i)if(!isNaN(c=+s.call(null,u=e[i],i,e))&&!isNaN(g=+l.call(null,u,i,e))){var u,c,g,h=Math.round(g/=n),d=Math.round(c=c/t-(1&h)/2),p=g-h;if(3*Math.abs(p)>1){var v=c-d,f=d+(c<d?-1:1)/2,m=h+(g<h?-1:1),y=c-f,b=g-m;v*v+p*p>y*y+b*b&&(d=f+(1&h?1:-1)/2,h=m)}var _=d+"-"+h,S=r[_];S?S.push(u):(a.push(S=r[_]=[u]),S.x=(d+(1&h)/2)*t,S.y=h*n)}return a}function c(e){var t=0,n=0;return P.map((function(i){var r=Math.sin(i)*e,a=-Math.cos(i)*e,o=r-t,s=a-n;return t=r,n=a,[o,s]}))}return u.hexagon=function(t){return"m"+c(null==t?e:+t).join("l")+"z"},u.centers=function(){for(var s=[],l=Math.round(r/n),u=Math.round(i/t),c=l*n;c<o+e;c+=n,++l)for(var g=u*t+(1&l)*t/2;g<a+t/2;g+=t)s.push([g,c]);return s},u.mesh=function(){var t=c(e).slice(0,4).join("l");return u.centers().map((function(e){return"M"+e+"m"+t})).join("")},u.x=function(e){return arguments.length?(s=e,u):s},u.y=function(e){return arguments.length?(l=e,u):l},u.radius=function(i){return arguments.length?(t=2*(e=+i)*Math.sin(w),n=1.5*e,u):e},u.size=function(e){return arguments.length?(i=r=0,a=+e[0],o=+e[1],u):[a-i,o-r]},u.extent=function(e){return arguments.length?(i=+e[0][0],r=+e[0][1],a=+e[1][0],o=+e[1][1],u):[[i,r],[a,o]]},u.radius(1)}().radius(s).x((function(e){return e.screenCoord[0]})).y((function(e){return e.screenCoord[1]}))(l).map((function(e,t){return{position:r.unprojectFlat([e.x,e.y]),points:e,index:t}})),radiusCommon:s}},getPosition:{type:"accessor",value:function(e){return e.position}},material:!0,_filterData:{type:"function",value:null,optional:!0}},he=function(e){function t(){return Object(r.a)(this,t),Object(o.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(a.a)(t,[{key:"shouldUpdateState",value:function(e){return e.changeFlags.somethingChanged}},{key:"initializeState",value:function(){var e=new ne({getAggregator:function(e){return e.hexagonAggregator},getCellSize:function(e){return e.radius}});this.state={cpuAggregator:e,aggregatorState:e.state,hexagonVertices:null},this.getAttributeManager().add({positions:{size:3,accessor:"getPosition"}})}},{key:"updateState",value:function(e){Object(l.a)(Object(s.a)(t.prototype),"updateState",this).call(this,e);var n=this.state,i=n.cpuAggregator,r=n.hexagonVertices;e.changeFlags.propsOrDataChanged&&this.setState({aggregatorState:i.updateState(e,{viewport:this.context.viewport,attributes:this.getAttributes()})});var a=(i.state.layerData||{}).hexagonVertices;if(a&&r!==a){var o=this.convertLatLngToMeterOffset(a);o&&this.setState({hexagonVertices:a,vertices:o})}else this.updateRadiusAngle()}},{key:"updateRadiusAngle",value:function(e){var t=this.context.viewport.getDistanceScales().unitsPerMeter,n=this.state.cpuAggregator;if(n.state.layerData&&n.state.layerData.radiusCommon){var i=n.state.layerData.radiusCommon/t[0];this.setState({angle:90,radius:i})}}},{key:"convertLatLngToMeterOffset",value:function(e){var t=this.context.viewport;if(Array.isArray(e)&&6===e.length){var n=e[0],i=e[3],r=[(n[0]+i[0])/2,(n[1]+i[1])/2],a=t.projectFlat(r),o=t.getDistanceScales(r).metersPerUnit;return e.map((function(e){var n=t.projectFlat(e);return[(n[0]-a[0])*o[0],(n[1]-a[1])*o[1]]}))}return c.a.error("HexagonLayer: hexagonVertices needs to be an array of 6 points")(),null}},{key:"getPickingInfo",value:function(e){var t=e.info;return this.state.cpuAggregator.getPickingInfo({info:t})}},{key:"_onGetSublayerColor",value:function(e){return this.state.cpuAggregator.getAccessor("fillColor")(e)}},{key:"_onGetSublayerElevation",value:function(e){return this.state.cpuAggregator.getAccessor("elevation")(e)}},{key:"_getSublayerUpdateTriggers",value:function(){return this.state.cpuAggregator.getUpdateTriggers(this.props)}},{key:"renderLayers",value:function(){var e=this.props,t=e.elevationScale,n=e.extruded,r=e.coverage,a=e.material,o=e.transitions,s=this.state,l=s.angle,u=s.radius,c=s.cpuAggregator,g=s.vertices,h=this.getSubLayerClass("hexagon-cell",x),d=this._getSublayerUpdateTriggers();return new h(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ue(n,!0).forEach((function(t){Object(i.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ue(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},g&&g.length?{vertices:g,radius:1}:{radius:u,angle:l},{diskResolution:6,elevationScale:t,extruded:n,coverage:r,material:a,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:o&&{getFillColor:o.getColorValue||o.getColorWeight,getElevation:o.getElevationValue||o.getElevationWeight}}),this.getSubLayerProps({id:"hexagon-cell",updateTriggers:d}),{data:c.state.layerData.data})}}]),t}(le);he.layerName="HexagonLayer",he.defaultProps=ge}}]);